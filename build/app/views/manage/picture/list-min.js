KISSY.add("app/views/manage/picture/list",function(t,e,a,i,n,r,l,s,d){var c=r.all;return function(t){return t.prototype.template='<div class="page-header clearfix"> <div class=title-bar> <h2 class=title>\u56fe\u7247\u5217\u8868</h2> </div> </div> <div class="page-body table-container"> <div class="toolbar clearfix"> <a href="#" class="btn btn-xsmall" mx-click=add>\u4e0a\u4f20\u56fe\u7247</a> <div class=table-settings> <a class="btn btn-xsmall" id=J_calendar href="#" bx-tmpl="calendar" bx-datakey="startTime,endTime"> {{startTime}} \u81f3 {{endTime}} </a> </div> </div> <table class="table pic-list" bx-name="tables" bx-tmpl="list" bx-datakey="list"> <thead> <tr {{^list}}class=no-data{{/list}}> <th class=left width=120>\u56fe\u7247\u9884\u89c8</th> <th class=left>\u56fe\u7247\u5730\u5740</th> <th class=left width=100>\u56fe\u7247\u5c3a\u5bf8</th> <th class=left width=150>\u4e0a\u4f20\u65f6\u95f4</th> </tr> </thead> <tbody> {{#list}} <tr> <td class=left> <div class=pic-cnt> <a href="{{picPath}}" target=_blank><img src="{{picPath}}!120"  /></a> </div> </td> <td class=left> <textarea class=textarea onclick="select()">{{picPath}}</textarea> </td> <td class=left>{{picSize}}</td> <td class=left>{{list_createdAt}}</td> </tr> {{/list}} {{^list}} <tr class=none> <td colspan=4> \u6682\u65e0\u6570\u636e </td> </tr> {{/list}} </tbody> </table> </div>',t}(e.extend({init:function(){var t=this;t.on("destroy",function(){var e=t.getManaged("calendar");e.destructor()})},locationChange:function(){this.render()},render:function(){var e=this,i=e.location,n=t.clone(i.params),r=n.startTime,s=n.endTime;r&&s?(r=l.dateParse(r),s=l.dateParse(s)):(r=l.dateRecent(-6),s=l.dateRecent(0)),e.manage("startTime",r),e.manage("endTime",s),e.manage(a.fetchAll([{name:"picture_list",urlParams:{startTime:l.dateFormat(r),endTime:l.dateFormat(s)}}],function(t,a){var i=a.get("data");e.setViewPagelet({list:i,startTime:l.dateFormat(r),endTime:l.dateFormat(s)},function(){e.components()})}))},components:function(){var t=this,e=(t.getManaged("pagelet"),t.getManaged("startTime")),a=t.getManaged("endTime"),i=new s({maxDate:new Date,trigger:"#J_calendar",align:{points:["br","tr"],offset:[0,0]},pages:2,rangeSelect:!0,popup:!0,triggerType:["click"],range:{start:e,end:a},autoRender:!1});i.on("rangeSelect",function(e){i.hide();var a=s.Date.format(e.start,"yyyy-mm-dd"),n=s.Date.format(e.end,"yyyy-mm-dd");t.navigate("startTime="+a+"&endTime="+n)}),t.manage("calendar",i)},"add<click>":function(t){t.halt();var e=this,a=c("#"+t.currentId).parent(".toolbar").offset().top,i=l.getDefaultDialogConfig({width:620,top:a}),n="app/views/manage/picture/add",r={callback:function(){e.render()}};l.showDialog(i,n,r)},renderer:{list:{createdAt:function(){return d(this.createdAt).format("YYYY-MM-DD HH:MM")}}}}))},{requires:["mxext/view","app/models/modelmanager","magix/vom","magix/router","node","app/util/util","brix/gallery/calendar/index","app/libs/moment"]});